<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, November 07, 2023, 7:42 AM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "GuinnessTools" generated by Plugin Wizard -->

<muclient>
<plugin
   name="GuinnessTools"
   author="Robbo"
   id="4df531891997d30ab67e9b94"
   language="Lua"
   purpose="Guinness's Imm Builder tools"
   save_state="y"
   date_written="2023-11-07 07:41:46"
   requires="5.06"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!-- Triggers  -->
<triggers>
  <trigger
   name="gagMpdumpHeaders"
   enabled="n"
   match="^@Y"
   regexp="y"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>
</triggers>



<!--  Aliases  -->

<aliases>
  <alias
   match="ggo"
   enabled="y"
   script="ggoNext"
   sequence="100"
  >
  </alias>
  <alias
   match="ggo *"
   enabled="y"
   script="ggoParam"
   sequence="100"
  >
  </alias>
  <alias
   match="mstatall * *"
   enabled="y"
   script="mstatAll"
   sequence="100"
  >
  </alias>
  <alias
   match="rstatall * *"
   enabled="y"
   script="rstatAll"
   sequence="100"
  >
  </alias>
  <alias
   match="ostatall * *"
   enabled="y"
   script="ostatAll"
   sequence="100"
  >
  </alias>
  <alias
   match="mpdumpall * *"
   enabled="y"
   script="mpdumpAll"
   sequence="100"
  >
  </alias>
  <alias
   match="toolbox help"
   enabled="y"
   script="OnHelp"
   sequence="100"
  >
  </alias>


</aliases>

<script>
<![CDATA[
local wait = 0.3

function OnHelp()
   local help = [[

                      Test Port Toolbox Help
=============================================================================
 ggo                       --> Alias for rgoto that increments the room vnum
                               you're in. Starts at 'rgoto 0'. (Guinness Go!)
 ggo #                     --> Sets ggo to # and goes!
 ggo reset                 --> Sets ggo back to 0.
 mstatall keyword #        --> Dumps mstat for each mob in 'keyword' area,
                               counting from 0 to #.
 rstatall keyword #        --> Dumps rstat for each room in 'keyword' area,
                               counting from 0 to #.
 ostatall keyword #        --> Dumps ostat for each room in 'keyword' area,
                               counting from 0 to #. The object is loaded
                               before ostat.
 mpdumpall keyword #       --> Does mpdump of all programs 0 to N.
                               Uses rawcolor mode and noline.
 meditall keyword #        --> Similar to mstatall, dumps mob editor
                               details.
 reditall keyword #        --> Similar to rstatall, dumps room editor
                               details.
 oeditall keyword #        --> Similar to rstatall, dumps room editor
                               details.                     
 toolbox help              --> Show this help file
]]

  print(help)
end

function ggoNext()
   -- Figure out our current room
   ggoCurrent = GetVariable("ggoNext")
   if ggoCurrent == nil then ggoCurrent = 0 end
   ggoCurrent = tonumber(ggoCurrent)

   Send("rgoto "..ggoCurrent)
   ggoCurrent = ggoCurrent + 1
   SetVariable("ggoNext",tostring(ggoCurrent))
end

function ggoParam(name,line,wildcards)
   local p = wildcards[1]
   if p == "reset" then
      DeleteVariable("ggoNext")
   else
      SetVariable("ggoNext",p)
      ggoNext()
   end
end

function rstatAll(name, line, wildcards)
   local area = wildcards[1]
   local max = tonumber(wildcards[2])
   local delay = wait
   local logfile = "rstat_"..area..".txt"
   local logEnabled = false
   if IsLogOpen() == true then
      logEnabled = true
      CloseLog()
   end
   OpenLog(logfile,false)
   Send("prompt")
   for i = 0,max do
      DoAfter(delay,"rstat "..area.."-"..i)
      delay = delay + wait
   end
   DoAfter(delay,"prompt")
   delay = delay + 3
   DoAfterSpecial(delay,'CloseLog()',sendto.script)
   if logEnabled == true then
      delay = delay + wait
      DoAfterSpecial(delay,'OpenLog("",true)',sendto.script)
   end
end

function mstatAll(name, line, wildcards)
   local area = wildcards[1]
   local max = tonumber(wildcards[2])
   local delay = wait
   Send("prompt")
   for i = 0,max do
      DoAfter(delay,"mstat "..area.."-"..i)
      delay = delay + wait
   end
   DoAfter(delay,"prompt")
end

function ostatAll(name, line, wildcards)
   local area = wildcards[1]
   local max = tonumber(wildcards[2])
   local delay = wait
   Send("prompt")
   for i = 0,max do
      DoAfter(delay,"oload "..area.."-"..i)
      delay = delay + wait
      DoAfter(delay,"ostat "..area.."-"..i.." world")
      delay = delay + wait
   end
   DoAfter(delay,"prompt")
end

function mpdumpAll(name, line, wildcards)
   -- Add some triggers to gag Flags, size, old vnum, etc and replace the Mobprog Id line.
   -- Single trigger matching on ^@Y would work, actually!
   local area = wildcards[1]
   local max = tonumber(wildcards[2])
   local delay = wait
   EnableTrigger("gagMpdumpHeaders",true)
   Send("rawcolor")
   Send("prompt")
   for i = 1,max do
      DoAfter(delay,"mpdump "..area.."-"..i.." noline")
      delay = delay + wait
   end
   DoAfter(delay,"rawcolor")
   delay = delay + wait
   DoAfter(delay,"prompt")
   delay = delay + wait
   DoAfterSpecial(delay,'EnableTrigger("gagMpdumpHeaders",false)',sendto.script)
end

]]>
</script>

</muclient>
