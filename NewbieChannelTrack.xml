<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, October 29, 2023, 5:47 PM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "NewbieChannelTrack" generated by Plugin Wizard -->

<muclient>
<plugin
   name="NewbieChannelTrack"
   author="Robbo"
   id="2bfe9ae1e08db06d4deb620b"
   language="Lua"
   purpose="Track contributors to Newbie Channel"
   date_written="2023-10-29 17:46:33"
   requires="5.06"
   version="1.0"
   save_state="y"
   >

</plugin>


<!-- Aliases -->
<aliases>
  <alias
   match="newbietracker show"
   enabled="y"
   name="alias_shownewbietracker"
   script="showNewbieTracker"
  >
  </alias>
  <alias
   match="newbietracker reset"
   enabled="y"
   name="alias_resetnewbietracker"
   script="resetNewbieTracker"
  >
  </alias>
</aliases>


<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match="^\[Newbie\] \((Advisor|Helper|Imm)\)(?:\s|.+?\s)(\w+)\: .+"
   regexp="y"
   name="capture_newbie"
   script="countNewbieContrib"
   sequence="100"
  >
  </trigger>
</triggers>

<script>
<![CDATA[
if ArrayExists("NewbieContributors") == false then
   ArrayCreate "NewbieContributors"
end
if ArrayExists("NewbieContribTypes") == false then
   ArrayCreate "NewbieContribTypes"
end

function OnPluginSaveState()
   SetVariable ("NewbieTrackerData", ArrayExport ("NewbieContributors", ","))
   SetVariable ("NewbieTrackerTypes", ArrayExport ("NewbieContribTypes", ","))
end

function OnPluginClose ()
   SetVariable ("NewbieTrackerData", ArrayExport ("NewbieContributors", ","))
   SetVariable ("NewbieTrackerTypes", ArrayExport ("NewbieContribTypes", ","))
end -- function

function OnPluginInstall ()
   local NewbieTrackerData = GetVariable("NewbieTrackerData")
   local NewbieTrackerTypes = GetVariable("NewbieTrackerTypes")
   if NewbieTrackerData ~= nil then
      ArrayImport ("NewbieContributors",NewbieTrackerData)
      ArrayImport ("NewbieContribTypes",NewbieTrackerTypes)
   end
end

function countNewbieContrib(name,line,wildcards)
   local type = wildcards[1]
   local player = wildcards[2]
   if ArrayKeyExists("NewbieContributors",player) == false then
      Note("[NewbieTracker] Adding new contributor: "..player.." ("..type..")")
      ArraySet ("NewbieContributors",player,"1")
      ArraySet ("NewbieContribTypes",player,type)
   else
      local count = tonumber(ArrayGet("NewbieContributors",player)) + 1
      ArraySet ("NewbieContributors",player,tostring(count))
   end
end

function showNewbieTracker()
   Note("Newbie Channel Contributors: (since last reset)")
   if ArraySize ("NewbieContributors") == 0 then return end
   for k, p in pairs(ArrayListKeys ("NewbieContributors")) do
     local c = ArrayGet("NewbieContributors",p)
     local t = ArrayGet("NewbieContribTypes",p)
     local ft = string.format("%8s",t)
     local fp = string.format("%-13s",p)
     local fc = string.format("%5d",tonumber(c))
     Note("["..ft.." ] "..fp..": "..fc)
   end
end

function resetNewbieTracker()
   Note("Clearing NewbieTracker data, current contents here:")
   showNewbieTracker()
   ArrayClear "NewbieContributors"
   ArrayClear "NewbieContribTypes"
end


]]>
</script> 


</muclient>
